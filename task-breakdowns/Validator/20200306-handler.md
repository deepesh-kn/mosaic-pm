# Handlers

- LinkProposedHandler;

    - Updates the following models:
        - Link
            - Get the CoreGA from the contract address [TODO]
            - Get the metachain Id using core GA 
            - Calculate the sourceTransitionHash using the following parameters
                - If the event is from OriginProtocore contract then the `sourceTransitionHash` is `0x0000000000000000000000000000000000000000000000000000000000000000`
                - If the event is from SelfProtocore contract then calculate the source transition hash using the following parameters:
                    - sourceKernelHash (from event),
                    - sourceOriginObservation (from event),
                    - sourceDynasty (from event),
                    - sourceAccumulatedGas (from event),
                    - sourceCommitteeLock (from event)
            - Calculates the VoteMessageHash using the following parameters
                - domainSeparator [TODO: get from DB]
                - sourceTransitionHash (calculated)
                - parentLinkTargetBlockHash (from DB)
                - targetBlockHash (from event)
                - parentLinkTargetBlockNumber (from DB)
                - targetBlockNumber (from event)
            - ```
                new Link(
                    voteMessageHash (calculated),
                    parentVoteMessageHash (from event),
                    true (hardcoded for isLeaf),
                    targetBlockNumber (from event),
                    targetBlockHash (from event),
                    targetFinalizationStatus [TODO, hardcoded as Registered],
                    sourceTransitionHash (calculated),
                    proposedMetablockHeight [TODO, may be emit from the event],
                    metachainId [TODO, from DB],
                    coreGA [TODO, from DB],
                    relativeSelfDynasty [TODO, may be emit from the event]
                )
              ```

- VotedLinkUpHandler;
    - Updates the following models
        - Link 
            - Upserts the link with the following params:
                - voteMessageHash (from event)
                - targetFinalizationStatus (from event)
- ProposedMetablockHandler;
    - The record should already exist in the DB, when register vote is called.
    - Updates the following models:
        - Metablock
            - metablockHash (from event, proposal) [TODO, check if this will already]
- UpdatedCoreStatusHandler;
    - Updates the following models
        - Core
            - An record in the core will be upserted
                - coreGA (get it from DB)
                - metachainId || null
                - Lifetime status || null
                - Core status  (Created, from event)
                - open metablock height || null
                - minimum validator count || null
                - maximum validator count || null
                - gasTarget || null
                - genesisOriginObservationBlockNumber || null
- StoredGenesisOriginObservationHandler;
    - Updates the following models
        - Core
            - Add genesisOriginObservationBlockNumber value from the event.
- PublishedEndpointHandler;
    - Updates the following models:
        - UntrustedEndpoint 
            - metachainId (from the event)
            - core (from the event)
            - validator (from the event)
            - service (from the event)
            - endpoint (from the event)
            
- LoggedOutValidatorHandler;
    - Updates the following models:
        - Validator
            - validatorGA - PK (from the event)
            - coreGA (from the DB)
            - beginHeight (dont change)
            - endHeight (from the event)
            - reputation (0, TODO: discuss this)
            - status (dont update)
            - withdrawal block height (from the event)
- CreatedCoreHandler;
    - Creates/Updates the following models:
        - Core
            - coreGA - PK (from the event)
            - metachainId (from the database)
            - Lifetime status (dont change)
            - Core status (dont change)
            - open metablock height
            - minimum validator count (from the event)
            - maximum validator count (from the event)
            - gasTarget (from the event)
            - genesisOriginObservationBlockNumber (dont update)
- JoinedValidatorHandler;
    - Creates/Updates the following models:
        - Validator
            - validatorGA - PK (from the event)
            - coreGA (from the event)
            - beginHeight (from the event)
            - endHeight (dont update)
            - reputation (dont update)
            - status (dont update)
            - withdrawal block height (dont update)
- UpdatedCoreLifetimeHandler;
    - Updates the following models:
        - Core
            - coreGA - PK (from the event)
            - metachainId (from the DB)
            - Lifetime status (from the event)
            - Core status (dont update)
            - open metablock height (dont update)
            - minimum validator count (dont update)
            - maximum validator count (dont update)
            - gasTarget (dont update)
            - genesisOriginObservationBlockNumber (dont update)
- PrecommittedMetablockHandler;
    - Updates the following models:
        - Metablock
            - metablockHash - PK (from the event)
            - metachainId (from the event, TODO: do we need this from event?)
            - metablockHeight (from the event, TODO: Do we need this from event?)
            - kernelHash (dont update)
            - transitionHash (dont update)
            - sourceBlockHash (dont update)
            - targetBlockHash (dont update)
            - sourceBlockNumber (dont update)
            - targetBlockNumber (dont update)
            - round (hardcoded Precommitted)
            - roundMetablockNumber (from the event)
- FormedMetablockCommitteeHandler;
    - Updates the following models:
        - Metablock
            - metablockHash - PK  (from the event)
            - metachainId (from the event, TODO: do we need this from event?)
            - metablockHeight (dont update)
            - kernelHash (dont update)
            - transitionHash (dont update)
            - sourceBlockHash (dont update)
            - targetBlockHash (dont update)
            - sourceBlockNumber (dont update)
            - targetBlockNumber (dont update)
            - round (hardcoded, CommitteeFormed)
            - roundMetablockNumber (from event. TODO: This should be emitted form the event)
        - Committee
            - committeeGA - PK (from the event)
            - metablockHash (from the event)
            - <s> formation height</s> (from the event, TODO: do we need this)
            - seed (update from event, TODO: introduce this in to events)
            - status (dont update)
            - decision (dont update)
            - size (from the event)
            - quorum (from the event, TODO: introduce this in to events)
        - Member
            - Creates the model locally by calulating the memberGA for each validator
            - Member
                - memberGA - PK (calculated locally)
                - validatorGA (from DB)
                - metablockHash (from the event)
                - CalculatedRank (calculated locally)
                - status (hardcoded, Missing)
                - position (hardcoded null)

- DecidedMetablockCommitteeHandler;
    - Updates the following models:
        - Metablock
            - metablockHash - PK (from the event)
            - metachainId (from the event, TODO: do we need this from event?)
            - metablockHeight (dont update)
            - kernelHash (dont update)
            - transitionHash (dont update)
            - sourceBlockHash (dont update)
            - targetBlockHash (dont update)
            - sourceBlockNumber (dont update)
            - targetBlockNumber (dont update)
            - round (hardcoded, CommitteeDecided )
            - roundMetablockNumber (from event. TODO: This should be emitted form the event)
        - Committee
            - committeeGA - PK (from the event)
            - metablockHash (from the event )
            - <s> formation height</s> (do not update)
            - seed (dont update)
            - status (dont update)
            - decision (from the event)
            - size (from the event, TODO: do we need this?)
            - quorum (dont update)
            
- CommittedMetablockHandler;
    - Updates the following models:
        - Metablock
            - metablockHash - PK (from the event)
            - metachainId (from the event, TODO: do we need this from event?)
            - metablockHeight (dont update)
            - kernelHash (dont update, TODO: do we need this in event?)
            - transitionHash (dont update)
            - sourceBlockHash (dont update)
            - targetBlockHash (dont update)
            - sourceBlockNumber (dont update)
            - targetBlockNumber (dont update)
            - round (hardcoded, Committed)
            - roundMetablockNumber
- UpdatedCommitteeStatusHandler
    - Updates the following models:
        - Committee
            - committeeGA - PK (from the event)
            - metablockHash (dont update)
            - <s> formation height</s> (dont update)
            - seed (dont update)
            - status (from the event)
            - decision (dont update)
            - size (dont update)
            - quorum (dont update)
- EnteredCommitteeMemberHandler
    - Updates the following models:
        - Member
            - memberGA - PK (from event)
            - validatorGA (dont update)
            - metablockHash (dont update)
            - CalculatedRank (dont update)
            - status (hardcoded, Entered)
            - position (hardcoded null)

- EjectedCommitteeMemberHandler
    - Updates the following models:
        - Member
            - memberGA - PK (from event)
            - validatorGA (dont update)
            - metablockHash (dont update)
            - CalculatedRank (dont update)
            - status (hardcoded, Ejected)
            - position (hardcoded null)

- CommittedMemberHandler
    - Updates the following models:
        - Member
            - memberGA - PK (from event)
            - validatorGA (dont update)
            - metablockHash (dont update)
            - CalculatedRank (dont update)
            - status (hardcoded, Committed)
            - position (hardcoded null)

- RevealedMemberHandler
    - Updates the following models:
        - Member
            - memberGA - PK (from event)
            - validatorGA (dont update)
            - metablockHash (dont update)
            - CalculatedRank (dont update)
            - status (hardcoded, Revealed)
            - position (from the event)
- CreateMetachaindHandler;
    - Updates the following models:
        - Metachain
            - metachainId - PK (from the event)
            - origin chain id (constant hardcoded)
            - anchorGA (from the event)
            - mosaic version (from the event)
            - consensus address (from the event)
            - erc20 gateway (from the event; TODO: need to add this inthe contract event)
            
- AvailableStateRootHandler
    - This is already implemented

- OpenedKernelHandler.
    - Get the validators delta from the DB.
    - Get the reputation delta from the DB.
    - Updates the following models:
        - Kernel
            - kernelHash (from the event)
            - coreGA (from the DB)
            - Kernel height (from the event)
            - parent (This is the metablockHash, from the event)
            - updated validators (Calculated, stringified json)
            - gas target (from the event)
            - status - (it's not in contract, Hardcoded value: OPENED)
    - Change the status of previous open kernel whose status was `coopened` to `committed`.
- CoopenedKernelHandler.
    - Updates the following models:
        - Kernel
            - kernelHash (from the event)
            - coreGA (Dont update)
            - Kernel height (from the event)
            - parent (dont update)
            - updated validators (dont update)
            - gas target (dont update)
            - status - (it's not in contract, Hardcoded value: CoOpened)


- DeclaredOpenKernelHandler.
    - Updates the following models.
        - Kernel
            - kernelHash (from the event)
            - coreGA (Dont update)
            - Kernel height (from the event)
            - parent (dont update)
            - updated validators (dont update)
            - gas target (dont update)
            - status - (it's not in contract, Hardcoded value: Declared)
        - OpenKernelIntent
            - open kernel intent hash - PK (TODO: do we need this?)
            - message hash (from the event)
            - kernel height (from the event, TODO: do we need this?)
            - kernel hash (from the event)
        -  Message
            - message hash (from the event)
            - message type (Hardcoded, Open new kernel )
            - intent hash (from the event, do we need this?)
            - source status (Hardcoded, Declared)
            - target status (do not update)
            - fee gas price (from the event)
            - fee gas limit (from the event)
            - source gateway global address (from the DB)
            - source declaration block height (from the event)
            
- ConfirmedOpenKernelHandler.
    - Updates the following models.
        - Kernel
            - kernelHash (from the event)
            - coreGA (Dont update)
            - Kernel height (dont update)
            - parent (dont update)
            - updated validators (dont update)
            - gas target (dont update)
            - status - (it's not in contract, Hardcoded value: Confirmed)
        -  Message
            - message hash (from the event)
            - message type (Hardcoded, Open new kernel )
            - intent hash (from the event, do we need this?)
            - source status (do not update)
            - target status (Hardcoded, Declared)
            - fee gas price (do not update)
            - fee gas limit (do not update)
            - source gateway global address (from the DB)
            - source declaration block height (do not update)

- SetupProtocoreHandler.
    - Updates the following models.
        - Protocore
            - protocoreGA - PK (From the event)
            - coreGA (get it from the DB, using metachainid from the event)
            - openMetablockHeight (from the event)
            
- UpdatedLinkTargetFinalizationStatusHandler.
    - TODO: do we need this?
- ProvenGatewayHandler;
    - Already implemented
- DeclaredDepositIntentHandler;
    - Updates the following models:
        -  DepositIntent
            - Deposit intent hash (calculated,TODO: do we need this?)
            - message hash (from the event)
            - deposit amount (from the event)
            - beneficiary (from the event)
        - Message
            - message hash (from the event)
            - message type (Hardcoded, Deposit)
            - intent hash (calculated,TODO: do we need this?)
            - source status (Hardcoded, Declared)
            - target status (do not update)
            - fee gas price (from the event)
            - fee gas limit (from the event)
            - sender (from the event)
            - source gateway global address (ConsensusGateway address)
            - source declaration block height (from the event)
- ConfirmedDepositIntentHandler;
    - Updates the following models:
        - Message
            - message hash (from the event)
            - message type (Hardcoded, Deposit)
            - intent hash (calculated,TODO: do we need this?)
            - source status (do not update)
            - target status (Hardcoded, Declared)
            - fee gas price (do not update)
            - fee gas limit (do not update)
            - sender (do not update)
            - source gateway global address (ConsensusGateway address)(do not update)
            - source declaration block height (do not update)
            
- DeclaredWithdrawIntentHandler;
    - Updates the following models:
        - WithdrawIntent
            - withdraw intent hash (calculated, TODO: do we need this?)
            - message hash (from the event)
            - amount (from the event)
            - beneficiary (from the event)
        - Message
            - message hash (from the event)
            - message type (Hardcoded, Withdraw)
            - intent hash (calculated,TODO: do we need this?)
            - source status (Hardcoded, Declared)
            - target status (do not update)
            - fee gas price (from the event)
            - fee gas limit (from the event)
            - sender (from the event)
            - source gateway global address (ConsensusCogateway address)
            - source declaration block height (from the event)
- ConfirmedWithdrawIntentHandler;
    - Updates the following models
        - Message
            - message hash (from the event)
            - message type (Hardcoded, Withdraw)
            - intent hash (calculated,TODO: do we need this?)
            - source status (Hardcoded, Declared)
            - target status (do not update)
            - fee gas price (from the event)
            - fee gas limit (from the event)
            - sender (from the event)
            - source gateway global address (ConsensusCogateway address)
            - source declaration block height (from the event)

- DepositedGenesisHandler
    - Updated the following models
        - GenesisDepositIntent
            - Deposit intent hash (from the event, TODO: do we need this?)
            - message hash (from the event)
            - deposit amount (from the event)
            - beneficiary (from the event)


- CreatedUtilityTokenHandler;
    - Already implementd


- ProxyCreationHandler
    - <>
